{% extends 'data_capture/step.html' %}

{% load staticfiles data_explorer_tags %}

{% block head_meta %}
  {% head_meta title="About CALC" description="About CALC, the Contract-Awarded Labor Category tool" %}
{% endblock %}

{% block body_class %}content--skinny{% endblock %}

{% block body %}
 <style>
  #file_upload{
    margin: 2.4rem 0;
    display: flex;
    position: relative;
    align-items: center;
    padding: .8rem 2.4rem;
    background-color: #f0f6fa;
    transition: background-color .5s,border-color .5s;
    -webkit-transition: background-color .5s,border-color .5s;
    -moz-transition: background-color .5s,border-color .5s;
    -o-transition: background-color .5s,border-color .5s;
    border: 2px dashed #547d8c;
    color: #547d8c;
    font-size: 2rem;
}
#file_upload input[type="file"]{
    width: 1px;
    height: 1px;
    opacity: 0.01;
    position: absolute;
}
.upload-chooser{
  font-size: 1.3em;
}
.upload-chooser.inactive label{
  font-family: "Libre Franklin",Helvetica,Arial,sans-serif;
  display: inline-block !important;
  font-size: 1.1em;
}
.upload-chooser.active label{
  font-family: "Libre Franklin",Helvetica,Arial,sans-serif;
  display: inline-block !important;
  font-size: 1.25rem;
}
.upload-chooser.inactive span{
  font-size: 1em;
}
.upload-chooser.active span{
  font-size: 1.25rem;
}
.upload-chooser.inactive .redo{
  display: none;
}
.upload-chooser.active .redo{
  display: inline-block;
}
upload-widget{
  margin: 0 !important;
} 
.file_name_holder{
    font-family: monospace;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    color: #547d8c;
    font-size: 2rem;
    letter-spacing: 1px;
}
</style> 
<script>
  function radioButtonChanged(selected_value){
    var file_upload = document.getElementById("file_upload");
    var url_upload = document.getElementById("url_upload");
    if(selected_value == "url"){
      file_upload.style.display="none";
      url_upload.style.display="block";
      document.getElementById('id_file').required=false;
      document.getElementById('id_url').required=true;
    }
    if(selected_value == "file"){
      url_upload.style.display="none";
      file_upload.style.display="block";
      document.getElementById('id_url').required=false;
      document.getElementById('id_file').required=true;
    }

  }


  function filechanged(el){   
    var filename = el.files[0].name;
    if(filename != ""){
      $('.file_name_holder').text(filename);
      $('.upload-chooser').removeClass('inactive').addClass('active');
      $('.upload-chooser label').text('choose a different file');
    }else{
      $('.file_name_holder').text("");
      $('.upload-chooser').removeClass('active').addClass('inactive');
      $('.upload-chooser label').text('choose file');
    }
    
  }

  function dropHandler(ev) {
    ev.preventDefault();
    if (ev.dataTransfer.items) {
      if (ev.dataTransfer.items[0].kind === 'file') {
        var file = ev.dataTransfer.items[0].getAsFile();
        console.log('... file[' + 0 + '].name ==== ' + file.name);
        //document.getElementById('id_file').value = file.name;
        //$('#id_file').val(file);
      }
    }else{
      console.log('... file[' + 0 + '].name = ' + ev.dataTransfer.files[0].name);
    }
  
}

function dragOverHandler(ev) {
  console.log('File(s) in drop zone'); 
  ev.preventDefault();
  ev.stopPropagation();
}

</script>
<div class="container">
  {% block content %}
  <!-- is="ajax-form" -->
    <form  method="post" action="/data-capture/capability_statement/"  enctype="multipart/form-data">
      {% csrf_token %}
      {% if request.is_ajax %}
      {% include 'data_capture/messages.html' %}
      {% endif %}

{{ form.non_field_errors }}

{{ form.file.errors }}

{{ form.file }}

{{ form.contract_number}}
  
      <div class="card">
        <div class="content">
          <fieldset>
            <label for="id_contract_number">Contract number:</label>
            <input type="text" name="contract_number" maxlength="128" required id="id_contract_number" />
            <p class="helptext">This should be the full contract number, e.g. GSXXXXXXX.</p>
          </fieldset>
        </div></br></br>

        <div class="content">
          <fieldset>
            <h2>Upload capability statement</h2>
            <p>Choose the capability statement you'd like to upload.</p>
            <div style="display: inline-block;width: 140px;">
                <input class="radio_option" type="radio" onchange="radioButtonChanged(this.value)" name="file_upload_option" value="file" required checked="checked" />
                File Upload
            </div>
            <div style="display: inline-block;">
                <input class="radio_option" type="radio" onchange="radioButtonChanged(this.value)" name="file_upload_option" value="url" required />
                URL
            </div>
          </fieldset>
        </div>
        <div class="content">
          <div id="file_upload">
            <upload-widget 
              ondragenter="dragOverHandler(event)"
              ondrop="dragOverHandler(event)"
              ondragover="dragOverHandler(event)"
              ondragleave="dragOverHandler(event)"
               >
                <input onchange="filechanged(this)" type="file" name="capability_file" id="id_file" required is="upload-input" accept=".pdf,.docx" />
                <span class="file_name_holder"></span>
                <br>
                <div class="upload-chooser inactive">
                  <span class="redo">Not right?</span>
                  <label for="id_file">Choose file</label>
                  <span>or Drag and Drop here. PDF or DOCX format, please.</span>
                </div>
            </upload-widget>
          </div>
          <div id="url_upload">
            <h4>Enter web URL</h4>
            <input type="text" placeholder="https://www.example.com" name="capability_url" id="id_url" />
          </div>
          <div class="form-button-row clearfix">
            <div class="submit-group">
              <span class="submit-label"></span>
              <input type="hidden" id="alert" name="alert" value="{{uploaded_file_status}}" readonly>
              <button class="usa-button usa-button-primary" type="submit">Submit</button>
            </div>
          </div>
        </div>
      </div>
    </form>

    {% if uploaded_file_status and form_submitted != 0 %}
      <script>
        $( document ).ready(function() {
          if ($('#alert').val() != ""){
            alert($('#alert').val());
            $('form').trigger('reset');
            location.href="/step_cap/"
          }
        });
      </script>
    {% endif %}

  {% endblock %}
</div>
<style>
  .radio_option{
    position: static;
    width:20px;
    height:20px;
    display: inline-block;
  }
  #url_upload{
    display: none;
  }
</style>
{% endblock %}
